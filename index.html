
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Calculadora PhenoAge - VitalExtension</title>
<style>
    :root {
      --color-principal: #2c3e50;
      --color-secundario: #27ae60;
      --color-fondo: #f9f9f9;
      --color-texto: #333;
      --color-optima: #e0f7fa;
      --color-normal: #fff3cd;
      --color-elevada: #f8d7da;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background-color: var(--color-fondo);
      color: var(--color-texto);
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    h1 {
      text-align: center;
      color: var(--color-principal);
      font-size: 26px;
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    button {
      margin-top: 30px;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background-color: var(--color-secundario);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #219150;
    }

    .result {
      margin-top: 30px;
      padding: 25px;
      border-radius: 10px;
      font-size: 18px;
      line-height: 1.5;
    }

    .optimal {
      background-color: var(--color-optima);
      color: #0077b6;
    }

    .normal {
      background-color: var(--color-normal);
      color: #856404;
    }

    .elevated {
      background-color: var(--color-elevada);
      color: #721c24;
    }

    .cta {
      margin-top: 25px;
      text-align: center;
    }

    .cta a {
      display: inline-block;
      padding: 12px 24px;
      background-color: var(--color-principal);
      color: white;
      text-decoration: none;
      font-weight: bold;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }

    .cta a:hover {
      background-color: #1b2f40;
    }

    
/* üé® Bot√≥n CTA reutilizable para acci√≥n posterior al resultado */
.cta-button {
  display: inline-block;
  padding: 12px 24px;
  background-color: var(--color-principal);
  color: white;
  text-decoration: none;
  font-weight: bold;
  border-radius: 6px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.cta-button:hover {
  background-color: #1b2f40;
  transform: scale(1.03);
}

@media (max-width: 600px) {
      .container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
<div class="container">
<h1>Calcula tu Edad Biol√≥gica (PhenoAge)</h1>
<form id="phenoForm">
<label>Edad cronol√≥gica (a√±os)</label>
<input id="age" step="0.1" type="number"/>
<label>Glucosa (mg/dL)</label>
<input id="glucose" step="0.1" type="number"/>
<label>Alb√∫mina (g/dL)</label>
<input id="albumin" step="0.1" type="number"/>
<label>Creatinina (mg/dL)</label>
<input id="creatinine" step="0.1" type="number"/>
<label>Prote√≠na C-reactiva (log mg/L)</label>
<input id="crp" step="0.1" type="number"/>
<label>Linfocitos (%)</label>
<input id="lymphocytes" step="0.1" type="number"/>
<label>Volumen corpuscular medio (MCV) (fL)</label>
<input id="mcv" step="0.1" type="number"/>
<label>RDW (%)</label>
<input id="rdw" step="0.1" type="number"/>
<label>Fosfatasa alcalina (U/L)</label>
<input id="alkphos" step="0.1" type="number"/>
<label>Leucocitos (10^3/¬µL)</label>
<input id="wbc" step="0.1" type="number"/>
<button onclick="calculatePhenoAge()" type="button">Calcular</button>
</form>

<div class="result" id="result"></div><!-- üîÅ Bloque CTA: bot√≥n con enlace actualizado a p√°gina de servicios -->

<!-- üß† CTA posterior al resultado -->
<div id="cta" style="display: none; opacity: 0; transition: opacity 0.8s ease-in; margin-top: 30px; text-align: center;">
  <!-- El contenido del bot√≥n se inserta din√°micamente desde JavaScript -->
</div>

<div id="lead-magnet" style="display: none; opacity: 0; transition: opacity 0.8s ease-in; margin-top: 30px; text-align: center;">
<p><strong>¬øQuieres recibir una gu√≠a gratuita con 7 claves cient√≠ficas que ayudar√°n a reducir tu riesgo?</strong></p>
<input id="userName" placeholder="Tu nombre (opcional)" style="margin-bottom: 10px;" type="text"/>
<br/>
<input id="userEmail" placeholder="D√©janos tu mejor email" type="email"/>
<!-- Pregunta CAPTCHA aleatoria -->
<div style="margin-top: 12px;">
<label id="captchaPregunta" style="font-size: 14px;">Cargando pregunta seguridad...</label><br/>
<input id="captchaRespuesta" style="margin-top: 4px; width: 60px;" type="text"/>
</div>
<!-- Honeypot (campo invisible para bots) -->
<input autocomplete="off" id="campoTrampa" style="display: none;" type="text"/>
<!-- Bot√≥n de env√≠o -->
<button class="btn btn-email" id="submitEmail" onclick="enviarEmail()" type="button">
<span id="btnText">Enviar</span>
<span id="spinner" style="display:none; margin-left:10px;">‚è≥</span>
</button>
<div style="margin-top: 12px; display: flex; align-items: center; font-size: 14px; color: #555;">
<label for="consentimientoRGPD" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
<input id="consentimientoRGPD" style="width: 16px; height: 16px; margin: 0;" type="checkbox"/>
<span>Acepto el tratamiento de mis datos conforme a la 
      <a href="https://nrventurini.github.io/Pol-tica_privacidad/" style="color: #12517c;" target="_blank">Pol√≠tica de Privacidad</a>.
    </span>
</label>
</div>
<p id="emailFeedback" style="color: red; display: none; margin-top: 10px;"></p>
<button class="btn" id="downloadBtn" onclick="window.open('https://github.com/nrventurini/ebook_longevidad/raw/main/guia-longevidad.pdf', '_blank')" style="display:none; margin-top: 20px;">
  üì• Descargar gu√≠a gratuita en PDF
</button>
<p style="font-size: 15px; color: #777; margin-top: 10px;">
  ‚öñÔ∏è <strong>Compromiso VitalExtension:</strong> Usaremos tu email solo para enviarte tu gu√≠a gratuita y contenido valioso sobre longevidad. Nunca enviaremos spam ni compartiremos tus datos.
</p>
</div></div>
<script>
// üìä Funci√≥n para calcular la edad biol√≥gica basada en los biomarcadores ingresados

function calculatePhenoAge() {
  const age = parseFloat(document.getElementById('age').value);
  const glucose = parseFloat(document.getElementById('glucose').value);
  const albumin = parseFloat(document.getElementById('albumin').value);
  const creatinine = parseFloat(document.getElementById('creatinine').value);
  const crp = parseFloat(document.getElementById('crp').value);
  const lymphocytes = parseFloat(document.getElementById('lymphocytes').value);
  const mcv = parseFloat(document.getElementById('mcv').value);
  const rdw = parseFloat(document.getElementById('rdw').value);
  const alkphos = parseFloat(document.getElementById('alkphos').value);
  const wbc = parseFloat(document.getElementById('wbc').value);

  const xb = (
    -19.907 +
    0.0336 * age +
    0.0095 * glucose +
    -0.259 * albumin +
    0.676 * creatinine +
    0.157 * crp +
    -0.021 * lymphocytes +
    0.0268 * mcv +
    0.3306 * rdw +
    0.00188 * alkphos +
    0.0554 * wbc
  );

  const phenoAge = 141.5 + Math.log(1 + Math.exp(xb)) * 10;
  const diff = phenoAge - age;
  let resultText = '';
  let cssClass = '';

  if (diff < -5) {
    cssClass = 'optimal';
    resultText = `üîµ ¬°Felicidades! Tu edad biol√≥gica es significativamente m√°s baja que tu edad real: <strong>${phenoAge.toFixed(1)} a√±os</strong>. Est√°s ganando la partida al envejecimiento.`;
  } else if (diff <= 5) {
    cssClass = 'normal';
    resultText = `üü° Tu edad biol√≥gica es de <strong>${phenoAge.toFixed(1)} a√±os</strong>, lo cual es similar a tu edad real. ¬°Est√°s en el camino correcto!`;
  } else {
    cssClass = 'elevated';
    resultText = `üî¥ Tu edad biol√≥gica es de <strong>${phenoAge.toFixed(1)} a√±os</strong>, lo cual es mayor que tu edad cronol√≥gica. Es hora de actuar para recuperar tu vitalidad.`;
  }

  document.getElementById('result').className = `result ${cssClass}`;

  // üß† Insertar resultado y mostrar CTA con enlace correcto
  document.getElementById('result').innerHTML = `
   ${resultText}
  `;

  document.getElementById("cta").innerHTML = `
    <!-- üß† Bot√≥n CTA con enlace a la p√°gina de servicios -->
   <a href="https://www.vitalextension.com/servicios/" target="_blank" class="cta-button">
      ¬°Quiero reducir mi edad biol√≥gica ahora!
    </a>
  `;


  document.getElementById("cta").style.display = "block";
  document.getElementById("lead-magnet").style.display = "block";
  setTimeout(() => {
    document.getElementById("cta").style.opacity = "1";
    document.getElementById("lead-magnet").style.opacity = "1";
  }, 100);

  const preguntasCaptcha = [
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 + 5?", respuesta: "8" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 10 - 5?", respuesta: "5" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 2 + 5?", respuesta: "7" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 6 - 2?", respuesta: "4" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 3 x 2?", respuesta: "6" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 1 x 2?", respuesta: "2" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 1 + 0?", respuesta: "1" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 1 + 2?", respuesta: "3" },
    { pregunta: "Pregunta de seguridad: ¬øCu√°nto es 6 + 3?", respuesta: "9" }
  ];
  captchaActual = preguntasCaptcha[Math.floor(Math.random() * preguntasCaptcha.length)];
  document.getElementById("captchaPregunta").textContent = captchaActual.pregunta;
}
</script>
<script>
// üì§ Funci√≥n auxiliar para enviar datos del formulario a Google Sheets usando App Script

function enviarResultadosAGoogleSheets(data) {
  const formData = new FormData();
  for (const key in data) {
    formData.append(key, data[key]);
  }

  fetch("https://script.google.com/macros/s/AKfycbxiG6oK4N_KJ6p6t9vjfEe82Z-RNl77-doyQg4SHv630Jyr3bl6uXPlcMXjnIUhXZRv/exec", {
    method: "POST",
    body: formData
  })
  .then(response => response.text())
  .then(text => console.log("‚úÖ Datos enviados:", text))
  .catch(error => console.error("‚ùå Error al enviar a Sheets:", error));
}

function enviarEmail() {
  const name = document.getElementById("userName").value.trim();
  const email = document.getElementById("userEmail").value;
  const feedback = document.getElementById("emailFeedback");
  const downloadBtn = document.getElementById("downloadBtn");
  const btnText = document.getElementById("btnText");
  const spinner = document.getElementById("spinner");
  const submitBtn = document.getElementById("submitEmail");

  // ‚úÖ Validaci√≥n RGPD
  if (!document.getElementById("consentimientoRGPD").checked) {
    feedback.textContent = "Debes aceptar la pol√≠tica de privacidad para continuar.";
    feedback.style.color = "red";
    feedback.style.display = "block";
    return;
  }

  // Validar honeypot
  if (document.getElementById("campoTrampa").value !== "") {
    feedback.textContent = "Detecci√≥n de comportamiento autom√°tico.";
    feedback.style.color = "red";
    feedback.style.display = "block";
    return;
  }

  // Validar CAPTCHA
  const captcha = document.getElementById("captchaRespuesta").value.trim();
  if (captcha !== captchaActual.respuesta) {
    feedback.textContent = "Respuesta incorrecta a la verificaci√≥n. Intenta de nuevo.";
    feedback.style.color = "red";
    feedback.style.display = "block";
    return;
  }

  // Validar email
  const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  if (!emailValid) {
    feedback.textContent = "Por favor, revisa que el email sea v√°lido.";
    feedback.style.color = "red";
    feedback.style.display = "block";
    downloadBtn.style.display = "none";
    return;
  }

  // Mostrar estado de env√≠o
  feedback.style.color = "green";
  feedback.textContent = "Enviando...";
  feedback.style.display = "block";
  btnText.textContent = "Enviando...";
  spinner.style.display = "inline-block";
  submitBtn.disabled = true;

  // Enviar datos a Google Sheets
  enviarResultadosAGoogleSheets({
    Nombre: name,
    Email: email,
    Origen: "Test_PhenoAge"
  });

  setTimeout(() => {
    feedback.textContent = "‚úîÔ∏è ¬°Listo! Tu gu√≠a est√° lista para descargar.";
    downloadBtn.style.display = "block";
    btnText.textContent = "Enviar";
    spinner.style.display = "none";
    submitBtn.disabled = false;
  }, 1200);
}
</script></body>
</html>
